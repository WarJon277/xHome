# Установка и запуск TTS-сервера

## Требования

- Python 3.10, 3.11 или 3.12 (Coqui-TTS несовместим с Python 3.13+)
- pip

## Установка

1. Убедитесь, что у вас установлена подходящая версия Python:
   ```bash
   python --version
   ```
   Если версия Python 3.13 или выше, установите Python 3.12 и используйте его для создания виртуального окружения.

2. Создайте виртуальное окружение с использованием Python 3.12:
   ```bash
   # Если у вас установлена версия Python 3.12 как python3.12
   python3.12 -m venv .venv
   # Или если вы установили Python 3.12 в определённый путь
   C:\Python312\python.exe -m venv .venv
   ```

3. Активируйте виртуальное окружение:
   - Windows (для PowerShell):
     Сначала измените политику выполнения:
     ```powershell
     Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
     ```
     Затем активируйте виртуальное окружение:
     ```powershell
     .venv\Scripts\Activate.ps1
     ```
   - Windows (для Command Prompt):
     ```cmd
     .venv\Scripts\activate.bat
     ```
   - Linux/macOS: `source .venv/bin/activate`

4. Перейдите в папку tts_service и установите зависимости:
   ```bash
   cd tts_service
   pip install -r requirements.txt
   ```

## Подготовка модели

При первом запуске сервера модель XTTS будет автоматически загружена из интернета. Это может занять некоторое время.

## Запуск сервера

1. Убедитесь, что виртуальное окружение активировано
2. Запустите сервер:
   ```bash
   python tts_server.py
   ```

Альтернативно, используйте скрипты запуска:
- Windows: `run_server.bat`
- Linux/macOS: `run_server.sh`

Сервер будет доступен по адресу: http://127.0.1:8002

## Настройка голоса

Поместите файл с образцом голоса в формате WAV с именем `speaker.wav` в корневую папку сервиса. Или укажите путь к файлу через переменную окружения `XTTS_SPEAKER_WAV`.

## Использование с ридером

После запуска сервера функция озвучки в ридере будет доступна. Убедитесь, что сервер запущен до открытия ридера.

## Автоматический запуск (Linux)

Для автоматической установки и запуска на Linux используйте скрипт `setup_and_run.sh`:

```bash
chmod +x setup_and_run.sh
./setup_and_run.sh
```

Скрипт автоматически:
- Проверит наличие Python 3.12
- Создаст виртуальное окружение
- Установит зависимости
- Запустит сервер